(window.webpackJsonp=window.webpackJsonp||[]).push([["topicData"],{"0+nS":function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.SysTag="SysTag",e.UserQuery="UserQuery"}(s||(s={}))},"2Sqd":function(e,t,i){"use strict";i.r(t),i.d(t,"FeedType",(function(){return s.a})),i.d(t,"FollowState",(function(){return o.a})),i.d(t,"ResizeServiceImage",(function(){return p})),i.d(t,"TopicSourceNameEnum",(function(){return r.a})),i.d(t,"TopicDataActions",(function(){return g.a})),i.d(t,"TopicDataConnector",(function(){return se})),i.d(t,"TopicDataReducer",(function(){return ae})),i.d(t,"TopicsFetchState",(function(){return a.a})),i.d(t,"ToolingInfo",(function(){return ce})),i.d(t,"clearTopicsCache",(function(){return n.a})),i.d(t,"registerTopicsCacheAppErrorCallback",(function(){return n.e})),i.d(t,"InterestsSearchServiceClient",(function(){return c.a})),i.d(t,"WindowsTopicDataProvider",(function(){return ne}));var s=i("0+nS"),o=i("uH2+"),r=i("623N"),a=i("FRpP"),n=i("6urM"),c=i("MMvm"),d=i("ADRF"),l=i("SNCn");var u;!function(e){e[e.LetterBox=1]="LetterBox",e[e.Scale=2]="Scale",e[e.Stretch=3]="Stretch",e[e.Crop=4]="Crop",e[e.FocalCrop=5]="FocalCrop",e[e.TmxResize=6]="TmxResize",e[e.AppExResize=7]="AppExResize",e[e.CustomCrop=8]="CustomCrop"}(u||(u={}));class p{constructor(e,t=0,i=0){this.url=e,this.height=t,this.width=i,this.mode=u.Crop,this.quality=60,this.url=(this.url||"").replace(/http:/,"https:").replace(/\?.*/,"")}static from(e){return e?new p(e.url,e.height,e.width):null}get src(){const e=[];return e.push({key:"w",value:Object(l.a)(this.width)}),e.push({key:"h",value:Object(l.a)(this.height)}),e.push({key:"m",value:Object(l.a)(this.mode)}),e.push({key:"q",value:Object(l.a)(this.quality)}),this.url+"?"+d.a.keyValueArrayToQueryString(e)}resizeTo(e,t){return this.width=t,this.height=e,this}}var h,g=i("FaCY"),b=i("D57K"),f=i("HxRh"),m=i("rvYQ"),v=i("I6Lx"),O=i("ax+D"),y=i("dTwT"),j=i("XMd8"),T=i("tERu"),w=i("rPvf"),S=i("8X6I"),I=i("SSDD"),C=i("k112"),F=i("KUTD"),R=i("k3mM"),E=i("C8K2");!function(e){e.topicCardBackupImageUrl="https://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtCmK3.img";e.TopicCardStandardDimensions={borderWidth:4,height:250,width:250,gutterSize:E.a},e.TopicCardImageStandardDimensions={height:242,width:242}}(h||(h={}));const k="feeds";var M=i("y+Kz"),U=i("6ADy"),A=i("msIb"),D=i("KETb"),P=i("ac9z"),x=i("fuIx"),L=i("e8jz"),q=i("CzGr"),N=i("Zsg4"),Q=i("kN1G"),X=i("/+Un"),H=i("OTRt"),G=i("hDMs"),K=i("MptA"),$=i("NuVg"),V=i("tMmC");class W{static TranslateToTopicGroups(e,t){if(V.a.logObjects(e),!O.a.isDefined(e)||!W.isValidCompositeCardResponse(e.value))throw new Error("Topics OneService response schema validation error: no valid topic groups found!");const i={topicGroupIds:[],topicGroupMap:{},topicMap:{}};return e.value[0].subCards.forEach(e=>{if(W.isValidTopicGroup(e,!0)){const s=W.getTopics(e,t);O.a.arrayHasData(s)&&(s.forEach(e=>{i.topicMap[e.id]=e}),i.topicGroupMap[e.id]={id:e.id,nextPageUrl:e.nextPageUrl,title:e.title,topicIds:s.map(e=>e.id)},i.topicGroupIds.push(e.id))}}),i}static TranslateToRecommendedTopics(e){if(V.a.logObjects(e),!O.a.isDefined(e)&&e.value)throw new Error("Topics OneService response schema validation error: no valid topic group found!");return e.value.map(e=>{const t=Object.assign(Object.assign({},e),{name:e.title,feedType:null});return W.getTopic(t,null)})}static TranslateSingleTopicResponseToTopic(e){if(!O.a.isDefined(e)||!W.isValidCompositeCardResponse(e.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const t=e.value[0].subCards;return W.getTopic(t[0],null)}static TranslateToFollowedTopics(e){if(V.a.logObjects(e),!O.a.isDefined(e)||!O.a.arrayHasData(e.value))throw new Error("Topics OneService response schema validation error: no valid followed topics found!");const t=e.value,i={};return t.forEach(e=>{if(e&&e.id){const t={};t[e.id]=[{followState:"followed"}],e.title&&(e.name=e.title,delete e.title);const s=W.getTopic(e,t);i[s.id]=s}}),i}static getTopic(e,t,i){if(!Object(K.a)(e.id)||!Object(K.a)(e.name))return null;let s;if(s=t&&O.a.arrayHasData(t[e.id])?t[e.id][0]:{followState:o.a.Unfollowed},!O.a.isDefined(s))return null;i||(i=h.TopicCardImageStandardDimensions);const r=e.image,a=r&&r.url?p.from(r).resizeTo(i.height,i.width).src:h.topicCardBackupImageUrl;return{id:e.id,name:e.name,followState:s.followState===o.a.Unfollowed||s.followState===o.a.None?o.a.Unfollowed:o.a.Followed,imgSrc:a,href:G.a.generateTopicLink(e.id,e.name),feedType:e.feedType,canonicalName:e.canonicalName,isInferred:e.isInferred,branding:e.branding,locale:e.locale}}static getTopics(e,t){const i=[];return e.subCards.forEach(s=>{const o=W.getTopic(s,e.metadata,t);i.push(o)}),i}static isValidTopicGroup(e,t){return(!t||Object(K.a)(e.id))&&!Object($.a)(e.metadata)&&O.a.arrayHasData(e.subCards)}static isValidCompositeCardResponse(e){return O.a.arrayHasData(e)&&O.a.arrayHasData(e[0].subCards)}}var z=i("YI90");class B{constructor(e,t=Object(U.c)(),i){this.fetchImpl=e,this.serviceURL=t,this.useEnterpriseCompliance=i}getFollowedTopics(e,t){var i;return Object(b.b)(this,void 0,void 0,(function*(){const s=yield this.getRequestInit(),o=yield this.getCommonParams(k),r=Object(x.b)()?null:Object(P.b)();if((this.useEnterpriseCompliance||Object(Q.j)())&&!(null===(i=null==s?void 0:s.headers)||void 0===i?void 0:i[M.w.authorization]))return{};const a=[...o,{key:M.x.queryType,value:"MyFeed"},{key:M.x.top,value:"1000"},{key:"allTopics",value:"true"},{key:"rndId",value:e?Object(z.a)(0,1e3).toString():null},{key:P.a,value:r?r.toString():null},{key:M.x.responseSchema,value:H.a.CardView}];t&&a.push({key:"$orderby",value:"createdDateTime desc"});const n=this.getLocationData();n&&!Object(x.b)()&&a.push({key:M.x.location,value:n});const c=Object(U.d)("msn/topics",this.serviceURL);this.appendQs(a,c);const d=yield this.sendRequest(decodeURIComponent(c.href),s,"getUserTopics");return W.TranslateToFollowedTopics(d)}))}getRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){const e=yield this.getRequestInit(),t=[...yield this.getCommonParams(k),{key:M.x.queryType,value:"recommendations"},{key:M.x.select,value:"id,title,image"}],i=Object(U.d)("msn/topics/me/recommendations",this.serviceURL);this.appendQs(t,i);const s=yield this.sendRequest(decodeURIComponent(i.href),e,"getRecommendedTopics");return W.TranslateToRecommendedTopics(s)}))}getRelatedTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){if(!e)return Promise.reject();const i=Object(U.d)("news/topics/{id}/related".replace("{id}",e.id),this.serviceURL),s=yield this.getCommonParams(k);t&&t>0&&s.push({key:M.x.top,value:t.toString()}),this.appendQs(s,i);const o=yield this.getRequestInit(),r=yield this.sendRequest(decodeURIComponent(i.href),o,"getRelatedTopics");return r&&0===r.length?r:W.TranslateToRecommendedTopics(r)}))}getTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i=yield this.getRequestInit(),s=yield this.getCommonParams(k),o=t||[...s,{key:M.x.queryType,value:"Discover"},{key:M.x.top,value:"100"},{key:M.x.select,value:"id,name,image,feedType,canonicalName,branding"}],r=this.getLocationData();r&&o.push({key:M.x.location,value:r});const a=Object(U.d)("msn/topics",this.serviceURL);this.appendQs(o,a);const n=yield this.sendRequest(decodeURIComponent(a.href),i,"getTopicGroups");return W.TranslateToTopicGroups(n,e)}))}getTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){const t=yield this.getRequestInit(),i=[...yield this.getCommonParams(k),{key:M.x.ids,value:e}],s=this.getLocationData();s&&i.push({key:M.x.location,value:s});const o=Object(U.d)("msn/topics",this.serviceURL);this.appendQs(i,o);const r=yield this.sendRequest(decodeURIComponent(o.href),t,"getTopic");return W.TranslateSingleTopicResponseToTopic(r)}))}updateTopicFollowingState(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){const s=Object(U.d)("Graph/Actions",this.serviceURL),o=yield this.getRequestInit(),r=yield this.getCommonParams(k),a=this.getLocationData();if(a&&r.push({key:M.x.location,value:a}),t){const t={actionType:"Follow"};(null==e?void 0:e.id)?t.targetId=null==e?void 0:e.id:i&&(t.definitionName=i),o.method="POST",o.headers["Content-Type"]="text/json",o.body=JSON.stringify(t),this.appendQs(r,s)}else{const t={key:M.x.filter,value:`actionType eq 'Follow' and (targetId eq '${null==e?void 0:e.id}')`};o.method="DELETE";const i=[t,...r];this.appendQs(i,s)}return yield this.sendRequest(decodeURIComponent(s.href),o,"updateTopicFollowingState")}))}restoreDefaultTopics(){return Object(b.b)(this,void 0,void 0,(function*(){const e=Object(U.d)("Graph/Actions",this.serviceURL),t=yield this.getRequestInit();t.method="DELETE";const i=[...yield this.getCommonParams(k),{key:M.x.filter,value:"actionType eq 'Follow'"}];this.appendQs(i,e);return yield this.sendRequest(decodeURIComponent(e.href),t,"restoreDefaultTopics")}))}getLocationData(){const e=Object(v.a)();return e.ClientSettings&&e.ClientSettings.geo_lat&&e.ClientSettings.geo_long?`${e.ClientSettings.geo_lat}|${e.ClientSettings.geo_long}`:null}getCommonParams(e){return Object(b.b)(this,void 0,void 0,(function*(){if(Object(x.b)())return this.getSapphireQueryParams();let t=!0;const i=yield this.isUserSignedIn();return v.b.IsBlendedEnterprise&&(e="entnewsntp",t=!1),i?A.a.getOneServiceParamsWithAuth(m.b.UserId,e,t):A.a.getOneServiceParamsWithoutAuth(m.b.UserId,e,t,null,!1,this.useEnterpriseCompliance)}))}getSapphireQueryParams(){const e=A.a.getOneServiceNonDynamicParamsWithoutAuth(k),t=Object(L.b)();return t&&(e.push({key:M.x.market,value:t.market}),e.push({key:M.x.fdhead,value:t.features}),e.push({key:M.x.activityId,value:t.activityId}),t.latitude&&t.longitude&&e.push({key:M.x.location,value:`${t.latitude}|${t.longitude}`})),e}getRequestInit(e=null){return Object(b.b)(this,void 0,void 0,(function*(){return null==e&&(e={method:"GET"}),(yield this.isUserSignedIn())&&(e.credentials="include"),e.headers=Object(x.b)()?yield Object(q.a)():yield A.a.getOneServiceHeaders(this.useEnterpriseCompliance),e}))}isUserSignedIn(){return Object(b.b)(this,void 0,void 0,(function*(){const e=Object(v.a)().UserIsSignedIn;if(void 0!==e)return e;return(yield Object(X.d)())===T.c.SignedIn}))}sendRequest(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){return Object(x.b)()?yield this.sapphireRequest(decodeURIComponent(e),t):yield this.networkRequest(decodeURIComponent(e),t,i)}))}sapphireRequest(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i={url:e,headers:t.headers,body:t.body,refresh:!0};let s;switch(t.method){case"POST":s=yield Object(N.j)(i);break;case"DELETE":s=yield Object(N.a)(i);break;default:s=yield Object(N.c)(i)}return JSON.parse(s||"{}")}))}networkRequest(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){const s=yield Object(D.a)(()=>Object(b.b)(this,void 0,void 0,(function*(){return yield this.fetchImpl(e,t)})),i);if(!s.ok)throw Error(s.statusText);return 204===s.status?[]:s.json()}))}appendQs(e,t){e.forEach(e=>{e.value&&t.searchParams.set(e.key,e.value)})}getMockWorkTopics(){return{"@odata.context":"http://api.msn.com/msn/topics/me/$metadata#work",value:[{id:"Y_d659302d-5ac4-460a-9baa-8c8684761110",title:"Microsoft In The News",image:{width:292,height:342,quality:98,url:"http://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtK2OS.img",title:"Travel News large interest image"}},{id:"Y_a952481b-5929-4b40-83be-f2bc6edf43dd",title:"Technology",image:{width:292,height:342,quality:98,url:"http://img-s-msn-com.akamaized.net/tenant/amp/entityid/AAtJSnh.img",title:"Weather large interest image"}}]}}}class J{constructor(e){this.servicesMap=e}getFollowedTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i=[],s=Object.entries(this.servicesMap).map(([s,o])=>o.getFollowedTopics(e,t).then(e=>(Object.values(e).forEach(e=>{e.apiSource={id:s,baseUrl:o.serviceURL}}),e)).catch(e=>(i.push({error:e,serviceId:s}),null)));return Promise.all(s).then(e=>{if((null==i?void 0:i.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(i);return Object.assign({},...e.filter(e=>e))})}))}getRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){const e=[],t=Object.entries(this.servicesMap).map(([t,i])=>i.getRecommendedTopics().then(e=>(e.forEach(e=>{e.apiSource={id:t,baseUrl:i.serviceURL}}),e)).catch(i=>(e.push({error:i,serviceId:t}),null)));return Promise.all(t).then(t=>{if((null==e?void 0:e.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(e);return t.filter(e=>e).reduce((e,t)=>e.concat(t),[])})}))}getRelatedTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.apiSource))return;const{id:i}=e.apiSource,s=this.servicesMap[i];return s?s.getRelatedTopics(e,t).then(e=>(e.forEach(e=>{e.apiSource={id:i,baseUrl:s.serviceURL}}),e)):void 0}))}getTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i=[],s=Object.entries(this.servicesMap).map(([s,o])=>o.getTopics(e,t).then(e=>(Object.values(e.topicMap).forEach(e=>{e.apiSource={id:s,baseUrl:o.serviceURL}}),e)).catch(e=>(i.push({error:e,serviceId:s}),null)));return Promise.all(s).then(e=>{if((null==i?void 0:i.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(i);const t=e.filter(e=>e);return{topicGroupIds:t.map(e=>e.topicGroupIds).reduce((e,t)=>e.concat(t),[]),topicGroupMap:Object.assign({},...t.map(e=>e.topicGroupMap)),topicMap:Object.assign({},...t.map(e=>e.topicMap))}})}))}getTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){const t=[],i=Object.entries(this.servicesMap).map(([i,s])=>s.getTopic(e).then(e=>(e.apiSource={id:i,baseUrl:s.serviceURL},e)).catch(e=>(t.push({error:e,serviceId:i}),null)));return Promise.all(i).then(e=>{if((null==t?void 0:t.length)===Object.keys(this.servicesMap).length)throw this.combineErrors(t);return e.reduce((e,t)=>e||t)})}))}updateTopicFollowingState(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){if(!(null==e?void 0:e.apiSource)){const s=this.servicesMap[r.a.consumer];return null==s?void 0:s.updateTopicFollowingState(e,t,i)}const{id:s}=e.apiSource,o=this.servicesMap[s];if(o)return o.updateTopicFollowingState(e,t,i)}))}restoreDefaultTopics(){return Object(b.b)(this,void 0,void 0,(function*(){const e=Object.entries(this.servicesMap).map(([e,t])=>t.restoreDefaultTopics());return Promise.all(e)}))}combineErrors(e){const t=e.filter(e=>e).reduce((e,t)=>{var i;return`${e} serviceId: ${t.serviceId}, Message: ${null===(i=t.error)||void 0===i?void 0:i.message};`},"");return new Error(t)}}var Y=i("XLvf"),Z=i("1w6q"),_=i("u5KZ"),ee=i("HDSB"),te=i("PZnQ"),ie=i("pMIE");class se extends Z.a{constructor(e,t,i,s,o,a,c){super(e,t,i,s,o,a,c),this.fetchedAllFollowedTopics=!1,this.fetchedAllRecommendedTopics=!1,this.fetchedAllTopics=!1;const d=Object(ee.a)()?window.fetch.bind(window):fetch;if(a&&a.useMultiTopicSource){const e={};e[r.a.work]=new B(d,m.b.EnterpriseServiceUrlBase,!0),e[r.a.consumer]=new B(d,m.b.ServiceUrlBase,!1),this.serviceClient=new J(e)}else this.serviceClient=new B(d);Object(ee.a)()&&(this.followedTopicsListKey=Object(n.b)("followedTopics")),this.trackAppErrorEventCallback=_.a?e=>_.a.sendAppErrorEvent(e):null;const l=Object(v.a)();this.useUserCreatedOrder=l.CurrentFlights.indexOf("prg-navfr-t")>-1,l.IsBlendedEnterprise&&(this.cardProvider=new w.a({initialRequest:{start:0,count:5,timeoutMs:3e3,disableFlatViewResponse:!0,select:"id",contentType:"article,video,slideshow,webcontent"}}))}registerTrackAppErrorEventCallback(e){this.trackAppErrorEventCallback=e}followTopic(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){const s=O.a.isNotNullOrUndefined(yield this.getFollowedTopic(e,t,i));return s&&(Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(x.b)()||Object(P.d)()),s}))}getFollowedTopic(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){let r=null;if(e&&(r=yield this.getTopic(e)),!Object(Y.isNullOrUndefined)(r)&&(r.followState!==o.a.Followed||i)||t){const e=r&&r.feedType!==s.a.UserQuery?r:null,i=r&&r.feedType===s.a.UserQuery?r.name:t,a=yield this.updateTopicFollowingState(e,o.a.Followed,i);a&&(r=yield this.getTopic((null==e?void 0:e.id)||a.targetId),!Object(x.b)()&&(yield Object(n.g)(r,!0,this.followedTopicsListKey)))}return Object(Y.isNullOrUndefined)(r)||r.followState!==o.a.Followed?void 0:r}))}getFollowedTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().followedTopicIds;return this.fetchedAllFollowedTopics&&!e||(e=e||(yield this.gettingTopicsAfterMigration()),(yield this.fetchFollowedTopics(e))&&(t=this.getCurrentState().followedTopicIds,e&&!Object(x.b)()&&Object(te.c)())),t}))}getOneServiceFollowedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.getFollowedTopics(!1,this.useUserCreatedOrder)}catch(e){this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching one service followed topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching one service followed topics. "+(e&&e.message)})}))}}))}getRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){return this.fetchedAllRecommendedTopics||(yield this.fetchRecommendedTopics()),this.getCurrentState().recommendedTopics}))}getRelatedTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){return this.getTopic(e).then(e=>this.serviceClient.getRelatedTopics(e,t))}))}getNextTopicsInList(e=null){return Object(b.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().topicListMap[e];return!Object(Y.isUndefined)(t)&&Object(Y.isString)(t.nextPageUrl)&&(yield this.fetchTopicGroup(e))&&(t=this.getCurrentState().topicListMap[e]),t}))}getTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){let t=this.getCurrentState().topicMap[e];return Object(Y.isUndefined)(t)&&(yield this.fetchTopic(e))&&(t=this.getCurrentState().topicMap[e]),t}))}getTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){return this.fetchedAllTopics||(yield this.fetchTopics(e)),this.getCurrentState().topicMap}))}unfollowTopic(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i=yield this.getTopic(e);let s=yield this.updateTopicFollowingState(i,o.a.Unfollowed,null,t);return s&&!t&&(Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(x.b)()||Object(P.d)(),Object(ee.a)()&&!Object(x.b)()&&(s=yield Object(n.g)(i,!1,this.followedTopicsListKey))),s}))}restoreDefaultTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.restoreDefaultTopics(),Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(x.b)()||Object(P.d)(),yield R.b.purgeCacheAsync(R.a.followedTopics),yield this.getFollowedTopics(!0),!0}catch(e){return this.trackAppError(Object.assign(Object.assign({},f.Xe.FailedRestoringDefaultTopicsError),{message:"Failed restoring default set of followed interests",pb:Object.assign(Object.assign({},f.Xe.FailedRestoringDefaultTopicsError.pb),{customMessage:"Error: "+(e&&e.message)})})),!1}}))}fetchFollowedTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){try{let t;e||!Object(ee.a)()||Object(x.b)()||(yield Object(n.d)(this.followedTopicsListKey),t=yield Object(n.c)(this.followedTopicsListKey));const i=t||(yield this.serviceClient.getFollowedTopics(e,this.useUserCreatedOrder));if(Object(v.a)().IsBlendedEnterprise){const e=Object.values(i).find(e=>"CompanyFeed"===e.branding);e&&(yield this.isLimitedFeed(e))&&delete i[e.id]}return t||(yield Object(n.f)(this.followedTopicsListKey,i,!0)),g.a.followedTopics.getActionSender(this).send(i,e),this.fetchedAllFollowedTopics=!0,!0}catch(e){return g.a.followedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching followed topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching followed topics. "+(e&&e.message)})})),!1}}))}isLimitedFeed(e){var t;return Object(b.b)(this,void 0,void 0,(function*(){try{const i={feedId:e.id};e.apiSource&&(i.overwriteBaseApiURL=e.apiSource.baseUrl,i.forceEnterpriseCompliance=(null===(t=e.apiSource)||void 0===t?void 0:t.id)===r.a.work);const s=yield this.cardProvider.fetch(i,!0);return!s||!s.cardMetadata||s.cardMetadata.length<5}catch(e){return this.trackAppError(Object.assign(Object.assign({},f.Li),{message:"[Enterprise] Failed to check if topic has limited data in feed",pb:Object.assign(Object.assign({},f.Li.pb),{customMessage:e&&e.message})})),!1}}))}fetchRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{const e=yield this.serviceClient.getRecommendedTopics();return g.a.recommendedTopics.getActionSender(this).send(Object(ie.a)(e)),this.fetchedAllRecommendedTopics=!0,!0}catch(e){return g.a.recommendedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveRecommendedTopicsError),{message:"Failed fetching recommended topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveRecommendedTopicsError.pb),{customMessage:"Failed fetching recommended topics. "+(e&&e.message)})})),!1}}))}fetchTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopic(e),i=this.getCurrentState().topicMap[e];return(Object(Y.isUndefined)(i)||i.followState!==t.followState)&&g.a.topic.getActionSender(this).send(t),!0}catch(t){return g.a.followedTopicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed to fetch topic.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to fetch topic ${e}. ${t&&t.message}`})})),!1}}))}fetchTopicGroup(e){return Object(b.b)(this,void 0,void 0,(function*(){if(!e)return!1;const t=this.getCurrentState().topicListMap[e],i=Object(Y.isUndefined)(t)||t.nextPageUrl;if(!Object(Y.isString)(i))return!1;const s=d.a.getParamsFromUrl(i);if(null===s)return!1;try{const t=yield this.serviceClient.getTopics(null,s);return g.a.topicGroup.getActionSender(this).send(t.topicGroupMap[e],t.topicMap),!0}catch(t){return g.a.topicGroupFailed.getActionSender(this).send(e),this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed to get topics list.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to get topics list ${e}. ${t&&t.message}`})})),!1}}))}fetchTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopics(e);return g.a.topics.getActionSender(this).send(t),this.fetchedAllTopics=!0,!0}catch(e){return g.a.topicsFailed.getActionSender(this).send(),this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed fetching topics.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:"Failed fetching topics. "+(e&&e.message)})})),!1}}))}updateTopicFollowingState(e,t,i,s){var r,a;return Object(b.b)(this,void 0,void 0,(function*(){try{const n=t===o.a.Followed,c=yield this.serviceClient.updateTopicFollowingState(e,n,i);return s?!n||(null===(r=null==c?void 0:c.value)||void 0===r?void 0:r.length)&&(null==c?void 0:c.value[0]):(yield R.b.purgeCacheAsync(R.a.followedTopics),!e&&n?yield this.getFollowedTopics(!0):g.a.updateTopicFollowedState.getActionSender(this).send(null==e?void 0:e.id,t,this.useUserCreatedOrder),!n||(null===(a=null==c?void 0:c.value)||void 0===a?void 0:a.length)&&(null==c?void 0:c.value[0]))}catch(i){return g.a.updateTopicFollowedStateFailed.getActionSender(this).send(null==e?void 0:e.id,t),void this.trackAppError(Object.assign(Object.assign({},t?f.Xe.InterestsFollowTopicError:f.Xe.InterestsUnfollowTopicError),{message:"Failed to update topic followed state.",pb:Object.assign(Object.assign({},t?f.Xe.InterestsFollowTopicError.pb:f.Xe.InterestsUnfollowTopicError.pb),{customMessage:`Failed to update followed state to ${t} for ${null==e?void 0:e.id}. ${i&&i.message}`})}))}}))}gettingTopicsAfterMigration(){return Object(b.b)(this,void 0,void 0,(function*(){return!(!Object(y.a)().getItem(j.a.InterestsNeedRefresh)||(yield Object(X.d)())!==T.c.SignedIn)&&(Object(y.a)().removeItem(j.a.InterestsNeedRefresh),!0)}))}trackAppError(e){this.trackAppErrorEventCallback&&this.trackAppErrorEventCallback(Object.assign(Object.assign({},e),{source:"TopicData.connector.ts"}))}}var oe=i("Z+pL"),re=i("05Au");class ae{reduce(e,t){if(!e)return{followedTopicIds:[],followedTopicNames:[],recommendedTopics:[],topicListIds:[],topicListMap:{},topicMap:{},topicsFetchState:a.a.InProgress};if(!t)return e;let i,s=!1;return s=s||re.a.handleAction(t,g.a.followedTopics,(t,s)=>{if(!t)return;const o=Object.assign({},e.topicMap);i=Object.assign(Object.assign({},e),{topicMap:o,topicsFetchState:a.a.Loaded});const r=[];Object.keys(t).forEach(e=>{r.push(e);const i=t[e];o[e]=i}),i.followedTopicIds=s?r:Object(oe.a)(i.followedTopicIds,r),i.followedTopicNames=i.followedTopicIds.map(e=>{var t;return null===(t=o[e])||void 0===t?void 0:t.name}),this.updateFollowState(i)}),s=s||re.a.handleAction(t,g.a.recommendedTopics,t=>{if(!t)return;const s=Object.assign({},e.topicMap);t.forEach(e=>{s[e.id]||(s[e.id]=e)}),i=Object.assign(Object.assign({},e),{recommendedTopics:t,topicMap:s,topicsFetchState:a.a.Loaded}),this.updateFollowState(i)}),s=s||re.a.handleAction(t,g.a.topic,t=>{const s=Object.assign({},e.topicMap);s[t.id]=t,i=Object.assign(Object.assign({},e),{topicMap:s,topicsFetchState:a.a.Loaded})}),s=s||re.a.handleAction(t,g.a.topics,t=>{if(!t)return;const s=Object.assign({},e.topicMap);Object.keys(t.topicMap).forEach(i=>{const o=e.topicMap[i];s[i]=Object.assign(Object.assign({},t.topicMap[i]),{isInferred:o&&o.isInferred})}),i=Object.assign(Object.assign({},e),{topicListIds:t.topicGroupIds,topicListMap:t.topicGroupMap,topicMap:s,topicsFetchState:a.a.Loaded}),this.updateFollowState(i)}),s=s||re.a.handleAction(t,g.a.topicGroup,(t,s)=>{if(!t||!t.topicIds||0===t.topicIds.length||!s)return;const o=Object.assign({},e.topicListMap),r=Object.assign({},e.topicMap),n=o[t.id];t.nextPageUrl&&(n.nextPageUrl=t.nextPageUrl),n&&n.topicIds&&(n.topicIds=Object(oe.a)(n.topicIds,t.topicIds)),t.topicIds.forEach(e=>{r[e]=s[e]}),i=Object.assign(Object.assign({},e),{topicListMap:o,topicMap:r,topicsFetchState:a.a.Loaded}),this.updateFollowState(i)}),s=s||re.a.handleAction(t,g.a.updateTopicFollowedState,(t,s,r)=>{var a,n;const c=Object.assign({},e.topicMap),d=e.followedTopicIds.slice(),l=e.followedTopicNames.slice(),u=e.topicMap[t];if(s!==o.a.Unfollowed){if(Object($.a)(u)){const e={followState:o.a.Followed,id:t,name:""};c[t]=e}else{if(u.followState===o.a.Followed&&!u.isInferred)return;u.followState===o.a.Followed&&u.isInferred&&(c[t].isInferred=!1),c[t].followState=o.a.Followed,i=Object.assign(Object.assign({},e),{topicMap:c})}d.indexOf(t)<0&&(r?l.unshift(null===(a=c[t])||void 0===a?void 0:a.name):l.push(null===(n=c[t])||void 0===n?void 0:n.name),r?d.unshift(t):d.push(t))}else{if(Object($.a)(u))return;c[t].followState=o.a.Unfollowed;const e=d.indexOf(t);e>=0&&(d.splice(e,1),l.splice(e,1))}const p=e.recommendedTopics.map(e=>Object.assign(Object.assign({},e),{followState:e.id===t?s:e.followState}));i=Object.assign(Object.assign({},e),{followedTopicIds:d,followedTopicNames:l,topicMap:c,recommendedTopics:p})}),s=s||re.a.handleAction(t,g.a.recommendedTopicsFailed,()=>{i=Object.assign(Object.assign({},e),{topicsFetchState:a.a.Failed})}),s=s||re.a.handleAction(t,g.a.followedTopicsFailed,()=>{i=Object.assign(Object.assign({},e),{topicsFetchState:a.a.Failed})}),i||e}updateFollowState(e){const{followedTopicIds:t}=e;Object.keys(e.topicMap).forEach(i=>{const s=e.topicMap[i];s&&(s.followState=t.includes(i)?o.a.Followed:o.a.Unfollowed)}),e.recommendedTopics.forEach(e=>{e.followState=t.includes(e.id)?o.a.Followed:o.a.Unfollowed})}}class ne{constructor(){this.fetchedAllFollowedTopics=!1,this.fetchedAllRecommendedTopics=!1,this.fetchedAllTopics=!1,this.serviceClient=new B(window.fetch.bind(window)),this.followedTopicsListKey=Object(n.b)("followedTopics"),this.useUserCreatedOrder=v.b.CurrentFlights.indexOf("prg-navfr-t")>-1,this.topicDataState={followedTopicIds:[],followedTopicNames:[],topicListIds:[],topicListMap:{},topicMap:{},recommendedTopics:[],topicsFetchState:null}}static getInstance(){return this.instance||(this.instance=new ne),this.instance}static resetInstance(){this.instance=new ne}getCurrentState(){return this.topicDataState}followTopic(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){const s=O.a.isNotNullOrUndefined(yield this.getFollowedTopic(e,t,i));return s&&(Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(P.d)()),s}))}getFollowedTopic(e,t,i){return Object(b.b)(this,void 0,void 0,(function*(){let r=null;if(e&&(r=yield this.getTopic(e)),!Object(Y.isNullOrUndefined)(r)&&(r.followState!==o.a.Followed||i)||t){const e=r&&r.feedType!==s.a.UserQuery?r:null,i=r&&r.feedType===s.a.UserQuery?r.name:t,a=yield this.updateTopicFollowingState(e,o.a.Followed,i);a&&(r=yield this.getTopic((null==e?void 0:e.id)||a.targetId),yield Object(n.g)(r,!0,this.followedTopicsListKey))}return Object(Y.isNullOrUndefined)(r)||r.followState!==o.a.Followed?void 0:r}))}getFollowedTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){let t=this.topicDataState.followedTopicIds;return this.fetchedAllFollowedTopics&&!e||(e=e||(yield this.gettingTopicsAfterMigration()),(yield this.fetchFollowedTopics(e))&&(t=this.topicDataState.followedTopicIds,e&&Object(te.c)())),t}))}getOneServiceFollowedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.getFollowedTopics(!1,this.useUserCreatedOrder)}catch(e){this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching one service followed topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching one service followed topics. "+(e&&e.message)})}))}}))}getRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){return this.fetchedAllRecommendedTopics||(yield this.fetchRecommendedTopics()),this.topicDataState.recommendedTopics}))}getRelatedTopics(e,t){return Object(b.b)(this,void 0,void 0,(function*(){return this.getTopic(e).then(e=>this.serviceClient.getRelatedTopics(e,t))}))}getTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){let t=this.topicDataState.topicMap[e];return Object(Y.isUndefined)(t)&&(yield this.fetchTopic(e))&&(t=this.topicDataState.topicMap[e]),t}))}getTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){return this.fetchedAllTopics||(yield this.fetchTopics(e)),this.topicDataState.topicMap}))}unfollowTopic(e,t){return Object(b.b)(this,void 0,void 0,(function*(){const i=yield this.getTopic(e);let s=yield this.updateTopicFollowingState(i,o.a.Unfollowed,null,t);return s&&!t&&(Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(P.d)(),s=yield Object(n.g)(i,!1,this.followedTopicsListKey)),s}))}restoreDefaultTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{return yield this.serviceClient.restoreDefaultTopics(),Object(C.a)(F.a.InterestsChange),Object(S.c)(I.a.InterestsChange),Object(P.d)(),yield R.b.purgeCacheAsync(R.a.followedTopics),yield this.getFollowedTopics(!0),!0}catch(e){return this.trackAppError(Object.assign(Object.assign({},f.Xe.FailedRestoringDefaultTopicsError),{message:"Failed restoring default set of followed interests",pb:Object.assign(Object.assign({},f.Xe.FailedRestoringDefaultTopicsError.pb),{customMessage:"Error: "+(e&&e.message)})})),!1}}))}subscribeTopicDataProviderState(e){e&&(this.stateChangeCallback=e,e(this.topicDataState))}fetchFollowedTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){try{let t;e||(yield Object(n.d)(this.followedTopicsListKey),t=yield Object(n.c)(this.followedTopicsListKey));const i=t||(yield this.serviceClient.getFollowedTopics(e,this.useUserCreatedOrder));return t||(yield Object(n.f)(this.followedTopicsListKey,i,!0)),this.setFollowedTopics(i,e),this.fetchedAllFollowedTopics=!0,!0}catch(e){return this.topicDataState.topicsFetchState=a.a.Failed,this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError),{message:"Failed fetching followed topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveFollowedTopicsError.pb),{customMessage:"Failed fetching followed topics. "+(e&&e.message)})})),!1}}))}fetchRecommendedTopics(){return Object(b.b)(this,void 0,void 0,(function*(){try{const e=yield this.serviceClient.getRecommendedTopics();return this.updateRecommendedTopics(e),this.fetchedAllRecommendedTopics=!0,!0}catch(e){return this.topicDataState.topicsFetchState=a.a.Failed,this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveRecommendedTopicsError),{message:"Failed fetching recommended topics",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveRecommendedTopicsError.pb),{customMessage:"Failed fetching recommended topics. "+(e&&e.message)})})),!1}}))}fetchTopic(e){return Object(b.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopic(e),i=this.topicDataState.topicMap[e];return(Object(Y.isUndefined)(i)||i.followState!==t.followState)&&(this.topicDataState.topicMap[t.id]=t),!0}catch(t){return this.topicDataState.topicsFetchState=a.a.Failed,this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed to fetch topic.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to fetch topic ${e}. ${t&&t.message}`})})),!1}}))}fetchTopicGroup(e){return Object(b.b)(this,void 0,void 0,(function*(){if(!e)return!1;const t=this.topicDataState.topicListMap[e],i=Object(Y.isUndefined)(t)||t.nextPageUrl;if(!Object(Y.isString)(i))return!1;const s=d.a.getParamsFromUrl(i);if(null===s)return!1;try{const t=yield this.serviceClient.getTopics(null,s);return this.updateTopicGroup(t.topicGroupMap[e],t.topicMap),!0}catch(t){return this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed to get topics list.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:`Failed to get topics list ${e}. ${t&&t.message}`})})),!1}}))}fetchTopics(e){return Object(b.b)(this,void 0,void 0,(function*(){try{const t=yield this.serviceClient.getTopics(e);return this.updateTopics(t),this.fetchedAllTopics=!0,!0}catch(e){return this.trackAppError(Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError),{message:"Failed fetching topics.",pb:Object.assign(Object.assign({},f.Xe.InterestsRetrieveTopicsError.pb),{customMessage:"Failed fetching topics. "+(e&&e.message)})})),!1}}))}updateFollowState(){const{followedTopicIds:e,topicMap:t,recommendedTopics:i}=this.topicDataState;Object.keys(t).forEach(i=>{const s=t[i];s&&(s.followState=e.includes(i)?o.a.Followed:o.a.Unfollowed)}),i.forEach(t=>{t.followState=e.includes(t.id)?o.a.Followed:o.a.Unfollowed}),this.reportTopicDataStateChange()}updateTopicFollowingState(e,t,i,s){var r,a;return Object(b.b)(this,void 0,void 0,(function*(){try{const n=t===o.a.Followed,c=yield this.serviceClient.updateTopicFollowingState(e,n,i);return s?!n||(null===(r=null==c?void 0:c.value)||void 0===r?void 0:r.length)&&(null==c?void 0:c.value[0]):(yield R.b.purgeCacheAsync(R.a.followedTopics),!e&&n?yield this.getFollowedTopics(!0):this.updateTopicFollowedState(null==e?void 0:e.id,t,this.useUserCreatedOrder),!n||(null===(a=null==c?void 0:c.value)||void 0===a?void 0:a.length)&&(null==c?void 0:c.value[0]))}catch(i){return void this.trackAppError(Object.assign(Object.assign({},t?f.Xe.InterestsFollowTopicError:f.Xe.InterestsUnfollowTopicError),{message:"Failed to update topic followed state.",pb:Object.assign(Object.assign({},t?f.Xe.InterestsFollowTopicError.pb:f.Xe.InterestsUnfollowTopicError.pb),{customMessage:`Failed to update followed state to ${t} for ${null==e?void 0:e.id}. ${i&&i.message}`})}))}}))}updateRecommendedTopics(e){if(!e)return;e=Object(ie.a)(e);const t=Object.assign({},this.topicDataState.topicMap);e.forEach(e=>{t[e.id]||(t[e.id]=e)}),this.topicDataState=Object.assign(Object.assign({},this.topicDataState),{recommendedTopics:e,topicMap:t,topicsFetchState:a.a.Loaded}),this.updateFollowState()}updateTopicGroup(e,t){if(!e||!e.topicIds||0===e.topicIds.length||!t)return;const i=Object.assign({},this.topicDataState.topicListMap),s=Object.assign({},this.topicDataState.topicMap),o=i[e.id];e.nextPageUrl&&(o.nextPageUrl=e.nextPageUrl),o&&o.topicIds&&(o.topicIds=Object(oe.a)(o.topicIds,e.topicIds)),e.topicIds.forEach(e=>{s[e]=t[e]}),this.topicDataState=Object.assign(Object.assign({},this.topicDataState),{topicListMap:i,topicMap:s,topicsFetchState:a.a.Loaded}),this.updateFollowState()}updateTopics(e){if(!e)return;const t=Object.assign({},this.topicDataState.topicMap);Object.keys(e.topicMap).forEach(i=>{const s=this.topicDataState.topicMap[i];t[i]=Object.assign(Object.assign({},e.topicMap[i]),{isInferred:s&&s.isInferred})}),this.topicDataState=Object.assign(Object.assign({},this.topicDataState),{topicListIds:e.topicGroupIds,topicListMap:e.topicGroupMap,topicMap:t,topicsFetchState:a.a.Loaded}),this.updateFollowState()}setFollowedTopics(e,t){if(!e)return;const i=Object.assign({},this.topicDataState.topicMap);this.topicDataState=Object.assign(Object.assign({},this.topicDataState),{topicMap:i,topicsFetchState:a.a.Loaded});const s=[];Object.keys(e).forEach(t=>{s.push(t);const o=e[t];i[t]=o}),this.topicDataState.followedTopicIds=t?s:Object(oe.a)(this.topicDataState.followedTopicIds,s),this.topicDataState.followedTopicNames=this.topicDataState.followedTopicIds.map(e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.name}),this.updateFollowState()}updateTopicFollowedState(e,t,i){var s,r;const a=Object.assign({},this.topicDataState.topicMap),n=this.topicDataState.followedTopicIds.slice(),c=this.topicDataState.followedTopicNames.slice(),d=this.topicDataState.topicMap[e];if(t!==o.a.Unfollowed){if(Object(Y.isUndefined)(d)){const t={followState:o.a.Followed,id:e,name:""};a[e]=t}else{if(d.followState===o.a.Followed&&!d.isInferred)return;d.followState===o.a.Followed&&d.isInferred&&(a[e].isInferred=!1),a[e].followState=o.a.Followed;Object.assign(Object.assign({},this.topicDataState),{topicMap:a})}i?c.unshift(null===(s=a[e])||void 0===s?void 0:s.name):c.push(null===(r=a[e])||void 0===r?void 0:r.name),i?n.unshift(e):n.push(e)}else{if(Object(Y.isUndefined)(d))return;a[e].followState=o.a.Unfollowed;const t=n.indexOf(e);n.splice(t,1),c.splice(t,1)}const l=this.topicDataState.recommendedTopics.map(i=>Object.assign(Object.assign({},i),{followState:i.id===e?t:i.followState}));this.topicDataState=Object.assign(Object.assign({},this.topicDataState),{followedTopicIds:n,followedTopicNames:c,topicMap:a,recommendedTopics:l}),this.reportTopicDataStateChange()}reportTopicDataStateChange(){this.stateChangeCallback&&this.topicDataState&&this.stateChangeCallback(this.topicDataState)}gettingTopicsAfterMigration(){return Object(b.b)(this,void 0,void 0,(function*(){return!(!Object(y.a)().getItem(j.a.InterestsNeedRefresh)||(yield Object(X.d)())!==T.c.SignedIn)&&(Object(y.a)().removeItem(j.a.InterestsNeedRefresh),!0)}))}trackAppError(e){_.a.sendAppErrorEvent(Object.assign(Object.assign({},e),{source:"WindowsTopicDataProvider.ts"}))}}const ce={experienceConfigSchema:{}}},"2pXY":function(e,t,i){"use strict";t.a=function(e,t,i){for(var s=-1,o=null==e?0:e.length;++s<o;)if(i(t,e[s]))return!0;return!1}},"623N":function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.consumer="consumer",e.work="work"}(s||(s={}))},CzGr:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i("D57K"),o=(i("fuIx"),i("Zsg4"),i("e8jz"));function r(){return Object(s.b)(this,void 0,void 0,(function*(){const e={},t=Object(o.b)();if(t){e.MUID=t.muid;const i=yield Object(o.a)("service::api.msn.com::MBI_SSL");"MSA"===t.accountType&&i?e.UserAuthToken=i:"AAD"===t.accountType&&i&&(e.Authorization=i)}return e}))}},FRpP:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e[e.InProgress=0]="InProgress",e[e.Loaded=1]="Loaded",e[e.Failed=2]="Failed"}(s||(s={}))},JFdr:function(e,t,i){"use strict";var s=Math.floor,o=Math.random;t.a=function(e,t){return e+s(o()*(t-e+1))}},LHdR:function(e,t,i){"use strict";var s=i("XhxR"),o=i("zI0X"),r=i("2pXY"),a=i("aPP9"),n=i("FROA"),c=i("d9YH"),d=i("U64u"),l=n.a&&1/Object(d.a)(new n.a([,-0]))[1]==1/0?function(e){return new n.a(e)}:c.a;t.a=function(e,t,i){var n=-1,c=o.a,u=e.length,p=!0,h=[],g=h;if(i)p=!1,c=r.a;else if(u>=200){var b=t?null:l(e);if(b)return Object(d.a)(b);p=!1,c=a.a,g=new s.a}else g=t?[]:h;e:for(;++n<u;){var f=e[n],m=t?t(f):f;if(f=i||0!==f?f:0,p&&m==m){for(var v=g.length;v--;)if(g[v]===m)continue e;t&&g.push(m),h.push(f)}else c(g,m,i)||(g!==h&&g.push(m),h.push(f))}return h}},LJMo:function(e,t,i){"use strict";var s;function o(e){switch(e){case"ArticlePreview":return 13;case"SlideshowPreview":return 14;case"VideoPreview":return 15;default:return null}}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o})),function(e){e.Article="article",e.Slideshow="slideshow",e.Video="video",e.Spotlight="content360",e.Infopane="infopane",e.TabbedInfopane="tabbedInfopane",e.HalfPane="HalfPane",e.HeadToHead="HeadToHead",e.Mosaic="Mosaic",e.Triptych="Triptych",e.TabbedInfopaneTab="tabbedInfopaneTab",e.WebContent="webcontent",e.ExternalLink="link",e.DenseList="DenseList",e.BackFillContent="BackfillContent",e.MyBriefRiverCard="toppicks",e.NativeAd="nativead",e.CmsAd="cmsad",e.ShoppingCard="ShoppingCard",e.ShoppingCarousel="ShoppingCarousel",e.ComicsCarousel="ComicsCarousel",e.EditorsPickCarousel="EditorsPickCarousel",e.SelectCarousel="SelectCarousel",e.DailyFixGamesCarousel="DailyFixGamesCarousel",e.SubscriptionCarousel="SubscriptionCarousel",e.TopStories="topStories",e.WorkHeadlines="workNews",e.Trending="trendingnow",e.TrendingInTenMinutes="trendingInTenMinutes",e.Horoscope="Horoscope",e.Elections="GenericElection",e.RecommendedSearchCarousel="RecommendedSearchCarousel",e.OnThisDay="OnThisDay",e.Lottery="Lottery",e.PartnerUpsell="PartnerUpsell",e.Qna="qnacard",e.Recipes="recipecard",e.TravelDestinationCard="TravelDestinationCard",e.BingHealthCovid19StatsCard="Covid19Stats",e.BingHealthCovidVaccTrialStatsCard="CovidVaccTrialStats",e.BingHealthCovidVaccStatsCard="CovidVaccStats",e.PlaceholderCard="placeholder",e.BingVideo="BingVideo",e.BingVideoCarousel="BingVideoCarousel",e.EsportsMatch="esportsMatch",e.EsportsTournament="esportsTournament",e.WeatherSummary="WeatherSummary",e.WeatherSummary_spotlight="WeatherSummary_spotlight",e.StockQuote="StockQuote",e.StockQuote_spotlight="StockQuote_spotlight",e.MoneyInfo="MoneyInfo",e.SportsMatch="SportsMatch",e.SportsOlympics="SportsOlympics",e.TrafficDelays="TrafficDelays",e.ShoppingMerchantCategoryDeals="ShoppingMerchantCategoryDeals",e.Group="group",e.Upsell="FreUpsell",e.Dense="densetab"}(s||(s={}))},MMvm:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var s=i("D57K"),o=i("ax+D"),r=i("rvYQ"),a=i("y+Kz"),n=i("6ADy"),c=i("msIb"),d=i("KETb"),l=i("fuIx"),u=i("CzGr"),p=i("e8jz"),h=i("Zsg4"),g=i("HxRh"),b=i("tERu"),f=i("/+Un"),m=i("NkTa");class v{constructor(e,t){this.fetchImpl=e,this.handleAppErrorEventCall=t,this.endPoint="msn/suggestions",this.servicdeOcid="feeds"}getSuggestedInterests(e,t,i){return Object(s.b)(this,void 0,void 0,(function*(){if(o.a.isNullOrWhiteSpace(e))return[];const s=e.trim(),r=yield this.getRequestInit(),a=[...yield this.getCommonParams(this.servicdeOcid),{key:"qscope",value:"news"},{key:"q",value:s},{key:"Type",value:i||"provider,bingtopic,category"},{key:"$top",value:String(t)}],c=Object(n.d)(this.endPoint);a.forEach(e=>e.value&&c.searchParams.set(e.key,e.value));const d=yield this.sendRequest(decodeURIComponent(c.href),r);if(!d)return null;let l=null;try{l=d.value[0].groups[0].suggestionItems}catch(e){this.handleAppErrorEventCall(g.Ze.ErrorResponseFromOneServiceIsInvalid)}return Object(m.a)(l,"id")}))}getRequestInit(e=null){return Object(s.b)(this,void 0,void 0,(function*(){return null==e&&(e={method:"GET"}),(yield Object(f.d)())===b.c.SignedIn&&(e.credentials="include"),e.headers=Object(l.b)()?yield Object(u.a)():yield c.a.getOneServiceHeaders(),e}))}getCommonParams(e){return Object(s.b)(this,void 0,void 0,(function*(){if(Object(l.b)())return this.getSapphireQueryParams();return(yield Object(f.d)())===b.c.SignedIn?c.a.getOneServiceParamsWithAuth(r.b.UserId,e):c.a.getOneServiceParamsWithoutAuth(r.b.UserId,e)}))}getSapphireQueryParams(){const e=c.a.getOneServiceNonDynamicParamsWithoutAuth(this.servicdeOcid),t=Object(p.b)();return t&&(e.push({key:a.x.market,value:t.market}),e.push({key:a.x.fdhead,value:t.features}),e.push({key:a.x.activityId,value:t.activityId}),t.latitude&&t.longitude&&e.push({key:a.x.location,value:`${t.latitude}|${t.longitude}`})),e}sendRequest(e,t){return Object(s.b)(this,void 0,void 0,(function*(){return Object(l.b)()?yield this.sapphireRequest(decodeURIComponent(e),t):yield this.networkRequest(decodeURIComponent(e),t)}))}sapphireRequest(e,t){return Object(s.b)(this,void 0,void 0,(function*(){const i={url:e,headers:t.headers,body:t.body,refresh:!0},s=yield Object(h.c)(i);return JSON.parse(s||"{}")}))}networkRequest(e,t){return Object(s.b)(this,void 0,void 0,(function*(){return yield Object(d.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){const i=yield this.fetchImpl(e,t);return i.ok?i.json():(this.handleAppErrorEventCall(g.Ze.ErrorResponseFromOneService),null)})),"getSuggestedInterests")}))}}},NkTa:function(e,t,i){"use strict";var s=i("wh7w"),o=i("LHdR");t.a=function(e,t){return e&&e.length?Object(o.a)(e,Object(s.a)(t,2)):[]}},NuVg:function(e,t,i){"use strict";t.a=function(e){return void 0===e}},OTRt:function(e,t,i){"use strict";var s,o;i.d(t,"a",(function(){return s})),function(e){e.CardView="cardview",e.FlatView="flatview"}(s||(s={})),function(e){e.t3="T3",e.t6="T6"}(o||(o={}))},XMd8:function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.InterestsNeedRefresh="interests-need-refresh"}(s||(s={}))},YI90:function(e,t,i){"use strict";var s=i("JFdr"),o=i("p6Gq"),r=i("syaE"),a=parseFloat,n=Math.min,c=Math.random;t.a=function(e,t,i){if(i&&"boolean"!=typeof i&&Object(o.a)(e,t,i)&&(t=i=void 0),void 0===i&&("boolean"==typeof t?(i=t,t=void 0):"boolean"==typeof e&&(i=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=Object(r.a)(e),void 0===t?(t=e,e=0):t=Object(r.a)(t)),e>t){var d=e;e=t,t=d}if(i||e%1||t%1){var l=c();return n(e+l*(t-e+a("1e-"+((l+"").length-1))),t)}return Object(s.a)(e,t)}},"Z+pL":function(e,t,i){"use strict";var s=i("4t6e"),o=i("2JSu"),r=i("LHdR"),a=i("NZVk"),n=Object(o.a)((function(e){return Object(r.a)(Object(s.a)(e,1,a.a,!0))}));t.a=n},ac9z:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return h})),i.d(t,"b",(function(){return g})),i.d(t,"c",(function(){return b}));var s=i("D57K"),o=i("k3mM"),r=i("hOj1"),a=i("rvYQ"),n=i("zfSW"),c=i("l+Jz"),d=i("tWvP");const l="cbypass";let u=parseInt(Object(r.a)(l))||0;function p(){return Object(s.b)(this,void 0,void 0,(function*(){u=Date.now(),Object(d.a)(l,u.toString(),10/1440,a.b.HostPage.topDomain,"/"),yield o.b.purgeCacheAsync(o.a.river),Object(n.d)({id:c.a.UpdateMyFeed,payload:u})}))}function h(){return Object(s.b)(this,void 0,void 0,(function*(){u=Date.now(),Object(d.a)(l,u.toString(),10/1440,a.b.HostPage.topDomain,"/"),yield o.b.purgeCacheAsync(o.a.river)}))}function g(){return u}function b(e){u>0&&e.searchParams.set(l,u.toString())}},eupA:function(e,t,i){"use strict";var s=i("JFdr");t.a=function(e,t){var i=-1,o=e.length,r=o-1;for(t=void 0===t?o:t;++i<t;){var a=Object(s.a)(i,r),n=e[a];e[a]=e[i],e[i]=n}return e.length=t,e}},hDMs:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var s,o=i("ADRF"),r=i("rvYQ");!function(e){e.contentUrlPrefixLookup={article:"ar",video:"vi",slideshow:"ss"},e.generateTopicLink=function(e,t){const i=o.a.encodeURIComponentForPrime(t).toLowerCase(),{HostPage:s}=r.b;if(s){const t=new URL(s.originalUrl);return t.origin+"/"+s.verticalKey+"/"+s.categoryKey+"/interests/"+i+"/"+r.b.CurrentMarket+"/f-"+e+t.search}return"https://www.msn.com"},e.generateContentLink=function(t,i,s,o,a){return t&&i&&s&&o&&a?`/${r.b.CurrentMarket}/${t}/${i}/${o}/${e.contentUrlPrefixLookup[a]}-${s}`:"/"}}(s||(s={}))},mOQN:function(e,t,i){"use strict";var s=i("oKML"),o=i("FoV5");t.a=function(e){return null==e?[]:Object(s.a)(e,Object(o.a)(e))}},oKML:function(e,t,i){"use strict";var s=i("mr4r");t.a=function(e,t){return Object(s.a)(t,(function(t){return e[t]}))}},pMIE:function(e,t,i){"use strict";var s=i("/XsO"),o=i("eupA");var r=function(e){return Object(o.a)(Object(s.a)(e))},a=i("mOQN");var n=function(e){return Object(o.a)(Object(a.a)(e))},c=i("SEb4");t.a=function(e){return(Object(c.a)(e)?r:n)(e)}},rPvf:function(e,t,i){"use strict";i.d(t,"a",(function(){return I}));var s=i("D57K"),o=i("HxRh"),r=i("tMmC"),a=i("y+Kz"),n=i("BQg2"),c=i("rvYQ"),d=i("VbA2"),l=i("zfSW"),u=i("I6Lx"),p=i("OTRt"),h=i("msIb"),g=i("6ADy"),b=i("KETb"),f=i("ac9z"),m=i("kN1G"),v=i("/+Un");class O{constructor(){this.cachedMetadata={}}get(e){const t=y(e);if(t)return this.cachedMetadata[t]}set(e,t){const i=y(e);i&&(this.cachedMetadata[i]=t)}}function y(e){if(e)return JSON.stringify(e)}var j=i("tERu"),T=i("u5KZ"),w=i("HDSB"),S=i("zJcZ");class I{constructor(e){this.config=e,this.responseCache=new O,this.requestPathWithoutFeedId="MSN/Feed/me",this.requestPathWithFeedId="MSN/Feed",this.requestPathForFeedLayout="MSN/FeedLayout"}fetch(e,t){return Object(s.b)(this,void 0,void 0,(function*(){let i=this.config.initialRequest;if(e&&(e.feedId||!i.feedId||e.nextPageUrl||(e.feedId=i.feedId),i=Object.assign(Object.assign({},i),e)),!i)return void T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.ag),{message:"default OneService fetch configuration was invalid"}));const l=this.responseCache.get(i);if(l)return l;const u=(null==e?void 0:e.forceEnterpriseCompliance)||Object(m.j)(),O=yield h.a.getOneServiceFeedCallHeaders(u);if(u&&!(null==O?void 0:O[a.w.authorization]))return;const y={credentials:"include",headers:O,method:"GET"},I=i.useNextPageUrl&&i.nextPageUrl,C=i.feedLayoutRequestType;let F;F=!I&&C?this.requestPathForFeedLayout:i.feedId?this.requestPathWithFeedId:this.requestPathWithoutFeedId;const R=Object(g.b)(F,null==e?void 0:e.overwriteBaseApiURL),E=Object(f.b)();if(I)this.requestQueryParams=new n.a(new URL(I).search),E>0&&this.requestQueryParams.set(f.a,E.toString()),c.b.SendFeedCallActivityIdInHeader||this.requestQueryParams.set(a.x.activityId,c.b.ActivityId);else{const{ocid:e,flightData:t,overwriteFlightData:s}=i,o=(yield Object(v.d)())===j.c.SignedIn?h.a.getOneServiceParamsWithAuth(c.b.UserId,e,!1,t,s):h.a.getOneServiceParamsWithoutAuth(c.b.UserId,e,!1,t,s,u);this.requestQueryParams=new n.a;for(let e=0;e<o.length;e++)this.requestQueryParams.set(o[e].key,o[e].value);if(C&&!i.start)this.requestQueryParams.set(a.x.feedLayoutRequestType,C);else if(!i.disableQueryType){const e=i.queryType||"myfeed";this.requestQueryParams.set(a.x.queryType,e)}if(this.requestQueryParams.set(a.x.responseSchema,i.disableFlatViewResponse?p.a.CardView:p.a.FlatView).set(a.x.wrapOData,"false").set(a.x.disableTypeSerialization,"true").set(a.x.timeOut,""+this.getRequestTimeout(i)).set(a.x.contentType,i.contentType).set(a.x.select,i.select),i.count&&this.requestQueryParams.set(a.x.top,""+i.count),this.tryAddQueryInterestParams(i)||this.requestQueryParams.set(a.x.ids,i.feedId).set(a.x.query,i.query),!C&&!i.disableLocation){const e=h.a.getLocationParams(i.latitude,i.longitude);e&&this.requestQueryParams.set(e.key,e.value)}i.start&&this.requestQueryParams.set(a.x.skip,""+i.start),i.infopaneItemCount&&(this.requestQueryParams.set(a.x.infopaneCount,""+i.infopaneItemCount),!1===i.complexInfopaneEnabled&&this.requestQueryParams.set(a.x.complexInfoPaneEnabled,"false")),E>0&&this.requestQueryParams.set(f.a,E.toString()),(i.useDelta||i.sessionId)&&(!1!==i.useDelta&&this.requestQueryParams.set(a.x.delta,"true"),i.sessionId&&this.requestQueryParams.set(a.x.session,i.sessionId))}let k,M,U,A;c.b.SendFeedCallActivityIdInHeader&&this.requestQueryParams.delete(a.x.activityId),R.search=this.requestQueryParams.toString();try{const e=Object(w.a)()?1e4:800,t=yield Object(b.a)(()=>Object(s.b)(this,void 0,void 0,(function*(){return yield Object(d.a)(decodeURIComponent(R.href),e,y)})),"OneServiceCardProvider.fetch");if(!t||!t.ok&&404!==t.status){U=t?t.status:null,A=t?t.statusText:null;const e=401===U?o.aj:o.Zf;return void T.a.sendAppErrorEvent(Object.assign(Object.assign({},e),{message:t?"OneService returned error response":"OneService response was null",pb:Object.assign(Object.assign({},e.pb),{fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href,statusCode:U,statusText:A}})}))}if(204===t.status||404===t.status?(k={feedItems:[]},U=t.status,A=t.statusText,T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Yf),{message:204===t.status?"Empty non first-page response":"Empty first-page response",pb:Object.assign(Object.assign({},o.Yf.pb),{fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href,statusCode:U,statusText:A}})}))):k=yield t.json(),t.headers){t.headers.get("X-Statics-Fallback")&&T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.bg),{pb:Object.assign(Object.assign({},o.bg.pb),{customMessage:"Request URL: "+decodeURIComponent(R.href)}),message:"Fell back to static content on the feeds call"}));const e=t.headers.get("ddd-tmpl");T.a.addOrUpdateTmplString(e),M=t.headers.get("ddd-session-id")}}catch(e){return void T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Uf),{message:"Error while fetching OneService response",pb:Object.assign(Object.assign({},o.Uf.pb),{customMessage:"Error: "+e,fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href}})}))}if(!k)return void T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Wf),{message:"Didn't get valid JSON from response.",pb:Object.assign(Object.assign({},o.Wf.pb),{fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href}})}));const D=(this.requestQueryParams.get(a.x.feedLayoutRequestType)||"").toLowerCase(),P="tabriver"===D||"tabs"===D,{nextPageUrl:x,feedItems:L}=this.requestQueryParams.get(a.x.responseSchema)===p.a.CardView?Object(S.b)(k,P):k;if(!L)return void T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Vf),{message:"Didn't get valid feed items list from response.",pb:Object.assign(Object.assign({},o.Vf.pb),{fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href,responseJson:JSON.stringify(k)}})}));if(!L.length&&!i.start)if(i.isSearchRequest)this.trackEmptyResponseForInterestSearch(i.feedId,i.query,R.href);else if(i.feedId){const{emptyResponseFeedIds:e}=this.config.initialRequest;t||i.feedId.startsWith("Q_")||e&&e.length&&-1!==e.indexOf(i.feedId)||this.trackEmptyResponseForXFeed(i.feedId,R.href)}else i.query?this.trackEmptyResponseForKidsMode(i.query,R.href):this.trackAppErrorHelper(o.Tf,"OneService returned an empty feed for a myfeed request.",R.href,null,null,"",U,A);if(P)if("tabriver"===D){const e=L.find(e=>"tabbedInfopane"===e.type);e&&e.subItems&&e.subItems.length||T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.vi),{pb:Object.assign(Object.assign({},o.vi.pb),{feedData:JSON.stringify(k),fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href,responseJson:JSON.stringify(k)}}),message:"TabRiver request returned empty content for tabbed infopane card."}))}else if("tabs"===D){let e=!1;e=!L.length||-1!==L.findIndex(e=>"tabbedInfopane"!==e.type||!e.subItems||!e.subItems.length),e&&T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.yi),{pb:Object.assign(Object.assign({},o.yi.pb),{fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:R.href,responseJson:JSON.stringify(k)}}),message:"Tabs request returned empty content for one or more tabbed infopane cards."}))}let q;if(L.length>=0?q=Object.assign(Object.assign({},i),{nextPageUrl:x,start:(i.start||0)+i.count}):r.a.log(`River has reached end of content stream. requested: ${i.count}, received: ${L.length}`),i.postRequestGrouping){const{start:e,count:t,type:s}=i.postRequestGrouping,o={type:s,subItems:L.splice(e,t)};L.splice(e,0,o)}const N={cardMetadata:L,nextPageRequest:q,sessionId:M};return this.responseCache.set(i,N),N}))}fetchFromWebWorker(e,t=1e3,i){return Object(w.a)()?Object(l.b)({id:e},t).then(e=>{const t=e.payload;if(!e.fetched||!t||!t.feedData)return null;t.responseSchema===p.a.CardView&&(t.feedData=Object(S.b)(t.feedData,t.isTabbedInfopaneResponse));const{nextPageUrl:s,feedItems:o=[]}=t.feedData;let r,a=this.config.initialRequest;if(i&&(a=Object.assign(Object.assign({},a),i)),s&&o.length&&(r=Object.assign(Object.assign({},a),{start:(a.start||0)+a.count,nextPageUrl:s})),a.postRequestGrouping){const{start:e,count:t,type:i}=a.postRequestGrouping,s={type:i,subItems:o.splice(e,t)};o.splice(e,0,s)}return{cardMetadata:o,nextPageRequest:r,sessionId:t.sessionId}}):Promise.resolve(null)}clearCache(){this.responseCache=new O}getRequestTimeout(e){const{timeoutMs:t,isSearchRequest:i,query:s,customFeedTimeoutMs:o}=e;return i&&s&&o?o:t}tryAddQueryInterestParams(e){if(!e.useVerticalAsInterest&&!e.useCategoryAsInterest)return!1;const t=(e.useVerticalAsInterest?u.b.ClientSettings.verticalKey:u.b.ClientSettings.categoryKey)||"",i=e.verticalCategoryKeyToInterestMapping[t.toLowerCase()],s=i||"news";return this.requestQueryParams.set(a.x.query,encodeURIComponent(s)).set(a.x.source,e.contentSource),i||e.useCategoryAsInterest&&!t||T.a.sendAppErrorEvent(Object.assign(Object.assign({},o.Xf),{message:"Failed to get content",pb:Object.assign(Object.assign({},o.Xf.pb),{customMessage:`Failed to get content for VerticalKey:${c.b.HostPage.verticalKey} | CategoryKey:${c.b.HostPage.categoryKey}. Loading fallback views river with ${s} content.`})})),!0}trackAppErrorHelper(e,t,i,s,o,r,a,n){let d="";s&&(d+=`Feed id: ${s}. `),o&&(d+=`Feed query: ${o}. `),T.a.sendAppErrorEvent(Object.assign(Object.assign({},e),{message:t,pb:Object.assign(Object.assign({},e.pb),{customMessage:d,fetchNetworkResponse:{activityId:c.b.ActivityId,requestUrl:i,responseJson:r,statusCode:a,statusText:n}})}))}trackEmptyResponseForKidsMode(e,t){this.trackAppErrorHelper(o.nc,"OneService returned an empty feed for kids mode",t,null,e)}trackEmptyResponseForXFeed(e,t){this.trackAppErrorHelper(o.mc,"OneService returned an empty feed for an x-feed page.",t,e,null)}trackEmptyResponseForInterestSearch(e,t,i){e?this.trackAppErrorHelper(o.oc,"OneService returned an empty feed for a user searched xfeed.",i,e,null):this.trackAppErrorHelper(o.pc,"OneService returned an empty feed for a user query.",i,null,t)}}I.providerName="OneService"},"uH2+":function(e,t,i){"use strict";var s;i.d(t,"a",(function(){return s})),function(e){e.Followed="followed",e.Unfollowed="unfollowed",e.Locked="locked",e.None="none"}(s||(s={}))},zI0X:function(e,t,i){"use strict";var s=i("QjXF");t.a=function(e,t){return!!(null==e?0:e.length)&&Object(s.a)(e,t,0)>-1}},zJcZ:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return c}));var s=i("LJMo"),o=i("HxRh"),r=i("u5KZ");function a(e,t=!1,i=!1){if(!e)return e;if(Array.isArray(e)){if(!e.length)return e;e=e[0]}if(!e||!e.subCards||!Array.isArray(e.subCards))return e;const s=e.subCards.map(e=>n(e,t,i));return!e.subCards.length||s&&s.length&&e.subCards.length===s.length||r.a.sendAppErrorEvent(Object.assign(Object.assign({},o.ob),{message:"Mapper returned invalid data",pb:Object.assign(Object.assign({},o.ob.pb),{customMessage:`Count mismatch - expected count [${e.subCards.length}] - actual count [${s.length}]`})})),{feedItems:s,nextPageUrl:e.nextPageUrl}}function n(e,t=!1,i=!1){if(!e)return{};if(e.type===s.a.SportsMatch||e.type===s.a.SportsOlympics||e.type===s.a.StockQuote||e.type===s.a.StockQuote_spotlight||e.type===s.a.TrafficDelays||e.type===s.a.WeatherSummary||e.type===s.a.WeatherSummary_spotlight||e.type===s.a.ShoppingMerchantCategoryDeals||e.type===s.a.MyBriefRiverCard||e.type===s.a.TopStories||e.type===s.a.Upsell||e.type===s.a.WorkHeadlines)return e;if(e.subCards)return t?{subItems:e.subCards.map(e=>n(e)),type:e.type||"tabbedInfopane"}:function(e){const{type:t,title:i}=e,s=e.subCards.map(e=>n(e));return{type:t,subItems:s,metadata:{title:i}}}(e);if(e.type===s.a.ExternalLink)return function(e){const{id:t,type:i,images:s,url:o,category:r,feed:a={},title:n="",abstract:c=""}=e,d=u(s)||{},p=l(o),{uiHint:h,actionText:g}=e.uiMetadata||{};return{id:t,type:i,metadata:{abstractLength:c.length,title:n,titleLength:n.length,category:r||p[4],subCategory:"other",primaryImage:{height:d.height,width:d.width,url:d.url},locale:p[3],url:o,abstract:c,uiHint:h,actionText:g,feed:{id:a.id},kicker:[{feedName:a.feedName}]}}}(e);if(e.type===s.a.WebContent&&!i)return function(e){const{id:t,type:i,images:s,url:o,category:r,locale:a,reactionSummary:n,commentSummary:c,tag:h,abstract:g="",feed:b={},title:f="",provider:m={},actions:v=[],isBreaking:O=0,externalVideoFiles:y={},publishedDateTime:j,colorSamples:T,dataUrl:w,sourceId:S,financeMetadata:I,isLocalContent:C}=e,F=u(s)||{},R=l(o);return{id:t,type:i,metadata:{abstract:g,abstractLength:g.length,titleLength:f.length,category:r||R[4],subCategory:R[5],publishedDateTime:j,externalVideoFiles:y,locale:a,feed:{id:b.id},kicker:[b],actions:v.map(e=>p[e]||e),reactionSummary:n,commentSummary:c,primaryImage:{height:F.height,width:F.width,url:F.url},url:o,title:f,provider:{name:m.name,logo:{url:m.logoUrl}}},cardContent:{id:t,type:i,title:f,abstract:g,isBreaking:O,tags:[h||{}],provider:{id:m.id,name:m.name,logoUrl:m.logoUrl,image:{alt:m.name,src:m.logoUrl}},category:{product:r,label:void 0},locale:a,images:[{id:d(F.url),height:F.height,width:F.width,caption:F.title,focalRegion:F.focalRegion,attribution:F.attribution,url:F.url,colorSamples:F.colorSamples}],colorSamples:T,videoFiles:y,publishedDateTime:j,kicker:f,sourceHref:w,destinationUrl:o,sourceId:S,financeMetadata:I,isLocalContent:C}}}(e);const{type:o,isBreaking:r,locale:a,category:h,images:g,topics:b=[],dataUrl:f,publishedDateTime:m,id:v,url:O,abstract:y="",title:j="",provider:T={},feed:w={},actions:S=[],externalVideoFiles:I,reactionSummary:C,commentSummary:F,engagementSummary:R,sourceId:E,financeMetadata:k,topComments:M,colorSamples:U,isLocalContent:A}=e,D=u(g)||{},P=I||{},x=b.find(e=>e.feedId===w.id&&e.locale===a),L=l(O);let q=d(T.logoUrl);return!q&&T.logo&&T.logo.url&&(q=d(T.logo.url)),{id:v,type:o,metadata:{abstractLength:y.length,titleLength:j.length,category:h||L[4],subCategory:L[5],primaryImage:{height:D.height,width:D.width},locale:a,feed:{id:w.id},kicker:[w],actions:S.map(e=>p[e]||e),reactionSummary:C,commentSummary:F,engagementSummary:R,topComments:M},cardContent:{id:v,type:c(o),title:j,uriTitle:L[6],abstract:y,isBreaking:r||0,tags:[x||{}],provider:{id:T.id,name:T.name,logo:{id:q},logoUrl:T.logoUrl,subscribable:!1},category:{product:h,label:void 0},locale:a,images:[{id:d(D.url),height:D.height,width:D.width,caption:D.title,focalRegion:D.focalRegion,attribution:D.attribution,url:D.url,colorSamples:D.colorSamples}],colorSamples:U,videoFiles:P,publishedDateTime:m,kicker:j,sourceHref:f,destinationUrl:O,sourceId:E,financeMetadata:k,isLocalContent:A}}}function c(e){switch(e){case"article":return"ArticlePreview";case"video":return"VideoPreview";case"slideshow":return"SlideshowPreview";case"webcontent":return"WebContentPreview";default:return""}}function d(e){if(!e)return"";if(e.includes("bing.com/th"))return;const t=e.split("/");return u(t)&&t[t.length-1].replace(".img","")}function l(e){return e?e.split("/"):[]}function u(e=[],t=0){return e[t]}const p={liked:"like",unliked:"unlike",saved:"save"}}}]);